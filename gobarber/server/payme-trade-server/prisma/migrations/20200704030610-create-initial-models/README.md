# Migration `20200704030610-create-initial-models`

This migration has been generated by Andr√© 'Dezzy' at 7/4/2020, 3:06:10 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Role" AS ENUM ('ADMIN', 'MANAGER', 'MODERATOR');

CREATE TYPE "Operation" AS ENUM ('CALL', 'PUT');

CREATE TYPE "Expiration" AS ENUM ('M1', 'M5', 'M15', 'M30', 'H1');

CREATE TYPE "Result" AS ENUM ('WIN', 'LOSS');

CREATE TYPE "Status" AS ENUM ('WAITING_PAYMENT', 'UNPAID', 'PAID', 'CANCELED');

CREATE TABLE "public"."users" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"email" text  NOT NULL ,"id" text  NOT NULL ,"name" text  NOT NULL ,"password" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"username" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."profiles" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"roles" "Role"[]  ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"user_id" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."statistics" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"profile_id" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."signals" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"currency" text  NOT NULL ,"date" timestamp(3)  NOT NULL ,"expiration" "Expiration" NOT NULL ,"gales" integer  NOT NULL DEFAULT 0,"id" text  NOT NULL ,"operation" "Operation" NOT NULL ,"result" "Result"  ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."recovery_password_requests" (
"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"id" text  NOT NULL ,"recovered" boolean  NOT NULL DEFAULT false,"token" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"user_id" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."subscriptions" (
"checkout_json" text  NOT NULL ,"created_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,"email" text  NOT NULL ,"id" text  NOT NULL ,"postbacks_json" text []  ,"profile_id" text   ,"status" "Status" NOT NULL ,"subscription_id" integer  NOT NULL ,"subscription_json" text  NOT NULL ,"updated_at" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."_Signal_won_by" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE TABLE "public"."_Signal_lost_by" (
"A" text  NOT NULL ,"B" text  NOT NULL )

CREATE UNIQUE INDEX "users.email" ON "public"."users"("email")

CREATE UNIQUE INDEX "users.username" ON "public"."users"("username")

CREATE UNIQUE INDEX "profiles_user_id" ON "public"."profiles"("user_id")

CREATE UNIQUE INDEX "statistics_profile_id" ON "public"."statistics"("profile_id")

CREATE UNIQUE INDEX "recovery_password_requests.token" ON "public"."recovery_password_requests"("token")

CREATE UNIQUE INDEX "_Signal_won_by_AB_unique" ON "public"."_Signal_won_by"("A","B")

CREATE  INDEX "_Signal_won_by_B_index" ON "public"."_Signal_won_by"("B")

CREATE UNIQUE INDEX "_Signal_lost_by_AB_unique" ON "public"."_Signal_lost_by"("A","B")

CREATE  INDEX "_Signal_lost_by_B_index" ON "public"."_Signal_lost_by"("B")

ALTER TABLE "public"."profiles" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."statistics" ADD FOREIGN KEY ("profile_id")REFERENCES "public"."profiles"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."recovery_password_requests" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."subscriptions" ADD FOREIGN KEY ("profile_id")REFERENCES "public"."profiles"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."_Signal_won_by" ADD FOREIGN KEY ("A")REFERENCES "public"."signals"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_Signal_won_by" ADD FOREIGN KEY ("B")REFERENCES "public"."statistics"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_Signal_lost_by" ADD FOREIGN KEY ("A")REFERENCES "public"."signals"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_Signal_lost_by" ADD FOREIGN KEY ("B")REFERENCES "public"."statistics"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200704030610-create-initial-models
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,132 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  @@map("users")
+
+  id                         String                    @id @default(uuid())
+  name                       String
+  email                      String                    @unique
+  username                   String                    @unique
+  password                   String
+  profile                    Profile
+  recovery_password_requests RecoveryPasswordRequest[]
+
+  created_at DateTime @default(now())
+  updated_at DateTime @default(now())
+}
+
+model Profile {
+  @@map("profiles")
+
+  id            String                @id @default(uuid())
+  user          User                  @relation(fields: [user_id], references: [id])
+  user_id       String
+  roles         Role[]
+  statistics    Statistics
+  subscriptions PagarMeSubscription[]
+
+  created_at DateTime @default(now())
+  updated_at DateTime @default(now())
+}
+
+model Statistics {
+  @@map("statistics")
+
+  id         String   @id @default(uuid())
+  profile    Profile  @relation(fields: [profile_id], references: [id])
+  profile_id String
+  wins       Signal[] @relation("Signal_won_by", references: [id])
+  losses     Signal[] @relation("Signal_lost_by", references: [id])
+
+  created_at DateTime @default(now())
+  updated_at DateTime @default(now())
+}
+
+model Signal {
+  @@map("signals")
+
+  id         String     @id @default(uuid())
+  currency   String
+  date       DateTime
+  operation  Operation
+  expiration Expiration
+  result     Result?
+  gales      Int        @default(0)
+
+  won_by  Statistics[] @relation("Signal_won_by", references: [id])
+  lost_by Statistics[] @relation("Signal_lost_by", references: [id])
+
+  created_at DateTime @default(now())
+  updated_at DateTime @default(now())
+}
+
+model RecoveryPasswordRequest {
+  @@map("recovery_password_requests")
+
+  id        String  @id @default(uuid())
+  user      User    @relation(fields: [user_id], references: [id])
+  user_id   String
+  token     String  @unique
+  recovered Boolean @default(false)
+
+  created_at DateTime @default(now())
+  updated_at DateTime @default(now())
+}
+
+model PagarMeSubscription {
+  @@map("subscriptions")
+
+  id                String   @id @default(uuid())
+  profile           Profile? @relation(fields: [profile_id], references: [id])
+  profile_id        String?
+  subscription_id   Int
+  email             String
+  status            Status
+  checkout_json     String
+  subscription_json String
+  postbacks_json    String[]
+
+  created_at DateTime @default(now())
+  updated_at DateTime @default(now())
+}
+
+enum Role {
+  ADMIN
+  MANAGER
+  MODERATOR
+}
+
+enum Operation {
+  CALL
+  PUT
+}
+
+enum Expiration {
+  M1
+  M5
+  M15
+  M30
+  H1
+}
+
+enum Result {
+  WIN
+  LOSS
+}
+
+enum Status {
+  WAITING_PAYMENT
+  UNPAID
+  PAID
+  CANCELED
+}
```


